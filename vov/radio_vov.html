<!DOCTYPE html><html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RÃ¡dio V O V â€” VersÃ£o Estendida</title>
  <style>
    :root{
      --bg:#0f1115;--panel:#171a21;--ink:#f2f2f2;--muted:#a7a7a7;--pri:#5dd2ff;--warn:#ff4d4d;--ok:#3ddc84;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:var(--bg);color:var(--ink);}
    header{padding:20px 16px;background:linear-gradient(180deg,#141821,#0f1115);border-bottom:1px solid #242836}
    h1{margin:0;font-weight:800;letter-spacing:.5px}
    .sub{color:var(--muted);margin-top:6px}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .card{background:var(--panel);border:1px solid #242836;border-radius:16px;padding:16px;margin:16px 0;box-shadow:0 8px 30px rgba(0,0,0,.25)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .stack{display:flex;flex-direction:column;gap:10px}
    video{width:100%;max-height:420px;border-radius:12px;background:black}
    .btn{appearance:none;border:none;border-radius:999px;padding:10px 16px;font-weight:700;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .b-white{background:#fff;color:#111}
    .b-warn{background:var(--warn);color:#fff}
    .b-ghost{background:transparent;border:1px solid #2b3042;color:var(--ink)}
    .b-pri{background:var(--pri);color:#00131a}
    .b-ok{background:var(--ok);color:#00160c}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .controls .btn{min-width:44px}
    .pill{padding:6px 10px;border-radius:999px;background:#1c2130;color:var(--muted);font-size:.85rem}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:2fr 1fr}}
    .now{font-weight:700}
    .input, input[type="url"], input[type="text"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2b3042;background:#10131b;color:var(--ink)}
    .list{margin:0;padding:0;list-style:none;max-height:360px;overflow:auto;border:1px solid #222635;border-radius:12px}
    .track{display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid #1e2232}
    .track:last-child{border-bottom:none}
    .track.active{background:#121729;border-left:3px solid var(--pri)}
    .track .name{flex:1}
    .track .mini{display:flex;gap:6px}
    .muted{color:var(--muted)}
    .hint{font-size:.9rem;color:var(--muted)}
    .tag{font-size:.75rem;padding:2px 8px;border:1px solid #2b3042;border-radius:999px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>RÃ¡dio V O V</h1>
    <div class="sub">Vinheta na abertura â€¢ Upload local â€¢ Playlist com PrÃ³xima Faixa</div>
  </header>  <div class="wrap">
    <!-- VINHETA -->
    <section id="vinhetawrap" class="card">
      <div class="stack">
        <video id="vinheta" autoplay muted playsinline>
          <source src="/vov/Vinheta_RV.mp4" type="video/mp4" />
        </video>
        <div class="row">
          <button id="btnSom" class="btn b-white">ğŸ”Š Som</button>
          <button id="btnSkip" class="btn b-warn">â­ï¸ Pular</button>
          <span class="pill">Dica: o autoplay funciona em <em>mute</em>. Toque em <strong>Som</strong> para habilitar o Ã¡udio.</span>
        </div>
        <div class="row">
          <label class="tag">ğŸ“‚ Trocar Vinheta</label>
          <input id="vinhetaUpload" type="file" accept="video/mp4,audio/mp3,video/webm,audio/mpeg" />
          <span class="hint">O arquivo roda localmente no seu navegador (nÃ£o faz upload para o servidor).</span>
        </div>
      </div>
    </section><!-- PLAYER + PLAYLIST -->
<section id="playerwrap" class="card" style="display:none">
  <div class="grid">
    <!-- LADO ESQUERDO: PLAYER PRINCIPAL -->
    <div class="stack">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div>
          <div class="muted">Tocando agora</div>
          <div id="nowTitle" class="now">â€”</div>
        </div>
        <div class="row">
          <span id="modeShuffle" class="tag">ğŸ”€ Shuffle: off</span>
          <span id="modeRepeat" class="tag">ğŸ” Repeat: off</span>
        </div>
      </div>

      <audio id="audio" preload="metadata"></audio>

      <div class="controls">
        <button id="prev" class="btn b-ghost" title="Anterior">â®ï¸</button>
        <button id="play" class="btn b-pri" title="Play/Pause">â–¶ï¸/â¸ï¸</button>
        <button id="next" class="btn b-ghost" title="PrÃ³xima">â­ï¸</button>
        <button id="shuffle" class="btn b-ghost" title="Alternar Shuffle">ğŸ”€</button>
        <button id="repeat" class="btn b-ghost" title="Alternar Repeat">ğŸ”</button>
        <button id="clear" class="btn b-warn" title="Limpar Playlist">ğŸ—‘ï¸ Limpar</button>
      </div>

      <div class="stack">
        <label class="muted">Adicionar streaming (Icecast/Shoutcast/URL de Ã¡udio):</label>
        <div class="row" style="gap:8px">
          <input id="streamUrl" type="url" class="input" placeholder="https://exemplo.com:8000/stream.mp3" />
          <button id="addStream" class="btn b-ok">â• Adicionar</button>
        </div>
        <div class="row" style="gap:8px">
          <label class="tag">ğŸ“¥ Arquivos locais</label>
          <input id="files" type="file" accept="audio/*" multiple />
        </div>
        <span class="hint">Dica: vocÃª pode selecionar vÃ¡rios arquivos de uma vez. Eles tocam apenas localmente (sem enviar para a internet).</span>
      </div>
    </div>

    <!-- LADO DIREITO: LISTA DE FAIXAS -->
    <div class="stack">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h3 style="margin:0">Playlist</h3>
        <span id="count" class="muted">0 faixas</span>
      </div>
      <ul id="playlist" class="list"></ul>
    </div>
  </div>
</section>

  </div>  <script>
    // ===================== VINHETA =====================
    const vinheta = document.getElementById('vinheta');
    const btnSom = document.getElementById('btnSom');
    const btnSkip = document.getElementById('btnSkip');
    const vinhetaWrap = document.getElementById('vinhetawrap');
    const vinhetaUpload = document.getElementById('vinhetaUpload');
    const playerWrap = document.getElementById('playerwrap');

    btnSom.addEventListener('click', () => { vinheta.muted = false; vinheta.play(); });
    btnSkip.addEventListener('click', () => { vinhetaWrap.style.display='none'; playerWrap.style.display='block'; });
    vinheta.addEventListener('ended', () => { vinhetaWrap.style.display='none'; playerWrap.style.display='block'; });
    vinhetaUpload.addEventListener('change', (e)=>{
      const f = e.target.files[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      vinheta.src = url;
      vinheta.muted = false;
      vinheta.play();
    });

    // ===================== PLAYER & PLAYLIST =====================
    const audio = document.getElementById('audio');
    const nowTitle = document.getElementById('nowTitle');
    const playlistEl = document.getElementById('playlist');
    const countEl = document.getElementById('count');

    const btnPrev = document.getElementById('prev');
    const btnPlay = document.getElementById('play');
    const btnNext = document.getElementById('next');
    const btnShuffle = document.getElementById('shuffle');
    const btnRepeat = document.getElementById('repeat');
    const btnClear = document.getElementById('clear');

    const streamUrl = document.getElementById('streamUrl');
    const addStream = document.getElementById('addStream');
    const filesInput = document.getElementById('files');

    const modeShuffle = document.getElementById('modeShuffle');
    const modeRepeat = document.getElementById('modeRepeat');

    /**
     * Estrutura da faixa na playlist:
     * { title: string, url: string, kind: 'local'|'stream' }
     */
    let tracks = [];
    let index = -1; // Ã­ndice da faixa atual
    let shuffle = false; // embaralhar
    // repeat: 0=off, 1=one, 2=all
    let repeat = 0;

    function renderPlaylist(){
      playlistEl.innerHTML = '';
      tracks.forEach((t, i)=>{
        const li = document.createElement('li');
        li.className = 'track' + (i===index ? ' active' : '');
        li.innerHTML = `
          <span class="tag">${t.kind === 'stream' ? 'URL' : 'Local'}</span>
          <div class="name">${escapeHtml(t.title)}</div>
          <div class="mini">
            <button class="btn b-ghost" data-act="up" data-i="${i}" title="Subir">â¬†ï¸</button>
            <button class="btn b-ghost" data-act="down" data-i="${i}" title="Descer">â¬‡ï¸</button>
            <button class="btn b-ghost" data-act="play" data-i="${i}" title="Tocar">â–¶ï¸</button>
            <button class="btn b-warn" data-act="del" data-i="${i}" title="Remover">ğŸ—‘ï¸</button>
          </div>`;
        li.addEventListener('dblclick', ()=> playAt(i));
        playlistEl.appendChild(li);
      });
      countEl.textContent = `${tracks.length} faixa${tracks.length===1?'':'s'}`;
    }

    function escapeHtml(s){return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');}

    function playAt(i){
      if(i<0||i>=tracks.length) return;
      index = i;
      const t = tracks[i];
      audio.src = t.url;
      audio.play().catch(()=>{});
      nowTitle.textContent = t.title;
      renderPlaylist();
      persistState();
    }

    function nextTrack(){
      if(tracks.length===0) return;
      if(repeat===1){ // repetir a mesma
        playAt(index);
        return;
      }
      if(shuffle){
        let ni = Math.floor(Math.random()*tracks.length);
        if(tracks.length>1){
          // evitar repetir a mesma na sequÃªncia
          while(ni===index){ ni = Math.floor(Math.random()*tracks.length); }
        }
        playAt(ni);
        return;
      }
      let ni = index + 1;
      if(ni >= tracks.length){
        if(repeat===2){ ni = 0; }
        else { audio.pause(); return; }
      }
      playAt(ni);
    }

    function prevTrack(){
      if(tracks.length===0) return;
      let pi = index - 1;
      if(pi < 0){ pi = (repeat===2 ? tracks.length-1 : 0); }
      playAt(pi);
    }

    audio.addEventListener('ended', nextTrack);

    btnPlay.addEventListener('click', ()=>{
      if(!audio.src){ if(tracks.length) playAt(0); return; }
      if(audio.paused) audio.play(); else audio.pause();
    });
    btnNext.addEventListener('click', nextTrack);
    btnPrev.addEventListener('click', prevTrack);
    btnShuffle.addEventListener('click', ()=>{
      shuffle = !shuffle; modeShuffle.textContent = `ğŸ”€ Shuffle: ${shuffle?'on':'off'}`; persistState();
    });
    btnRepeat.addEventListener('click', ()=>{
      repeat = (repeat+1)%3; // 0->1->2->0
      const label = repeat===0?'off':(repeat===1?'one':'all');
      modeRepeat.textContent = `ğŸ” Repeat: ${label}`; persistState();
    });
    btnClear.addEventListener('click', ()=>{
      audio.pause(); audio.removeAttribute('src'); nowTitle.textContent='â€”';
      tracks = []; index = -1; renderPlaylist(); persistState();
    });

    // Reordenar / tocar / remover via botÃµes de cada item
    playlistEl.addEventListener('click', (e)=>{
      const btn = e.target.closest('button');
      if(!btn) return;
      const act = btn.dataset.act; const i = +btn.dataset.i;
      if(act==='play') playAt(i);
      if(act==='del') { tracks.splice(i,1); if(index>=tracks.length) index=tracks.length-1; renderPlaylist(); persistState(); }
      if(act==='up' && i>0){ [tracks[i-1],tracks[i]]=[tracks[i],tracks[i-1]]; index = (index===i? i-1 : index===i-1? i : index); renderPlaylist(); persistState(); }
      if(act==='down' && i<tracks.length-1){ [tracks[i+1],tracks[i]]=[tracks[i],tracks[i+1]]; index = (index===i? i+1 : index===i+1? i : index); renderPlaylist(); persistState(); }
    });

    // Adicionar streaming URL
    addStream.addEventListener('click', ()=>{
      const url = (streamUrl.value||'').trim();
      if(!url) return;
      const title = inferTitleFromUrl(url);
      tracks.push({ title, url, kind:'stream' });
      renderPlaylist(); persistState();
      if(tracks.length===1) playAt(0);
      streamUrl.value='';
    });

    function inferTitleFromUrl(u){
      try{ const p = new URL(u); return decodeURIComponent((p.pathname.split('/').pop()||p.host) || u); }catch{ return u; }
    }

    // Adicionar arquivos locais
    filesInput.addEventListener('change', (e)=>{
      const files = Array.from(e.target.files||[]);
      for(const f of files){
        const url = URL.createObjectURL(f);
        tracks.push({ title: f.name, url, kind:'local' });
      }
      renderPlaylist(); persistState(); if(tracks.length && index===-1) playAt(0);
      filesInput.value='';
    });

    // PersistÃªncia mÃ­nima (sem blobs locais, apenas modos + Ã­ndice + URLs de stream)
    function persistState(){
      try{
        const data = {
          shuffle, repeat, index,
          tracks: tracks.map(t=> t.kind==='stream' ? t : null).filter(Boolean)
        };
        localStorage.setItem('vov_radio_state', JSON.stringify(data));
      }catch{}
    }

    function restoreState(){
      try{
        const raw = localStorage.getItem('vov_radio_state');
        if(!raw) return;
        const data = JSON.parse(raw);
        shuffle = !!data.shuffle; repeat = data.repeat|0; index = -1;
        modeShuffle.textContent = `ğŸ”€ Shuffle: ${shuffle?'on':'off'}`;
        const label = repeat===0?'off':(repeat===1?'one':'all');
        modeRepeat.textContent = `ğŸ” Repeat: ${label}`;
        // sÃ³ restauramos URLs de stream
        tracks = Array.isArray(data.tracks) ? data.tracks.map(t=>({title:t.title,url:t.url,kind:'stream'})) : [];
        renderPlaylist();
        if(typeof data.index==='number' && tracks[data.index]){ playAt(data.index); }
      }catch{}
    }

    restoreState();
    // ===== Atalhos de teclado =====
    document.addEventListener('keydown', (e) => {
      const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : '';
      if (tag === 'input' || tag === 'textarea') return; // nÃ£o interferir ao digitar
      switch (e.code) {
        case 'Space':
          e.preventDefault();
          btnPlay.click();
          break;
        case 'ArrowRight':
          e.preventDefault();
          nextTrack();
          break;
        case 'ArrowLeft':
          e.preventDefault();
          prevTrack();
          break;
        case 'KeyS': // toggle shuffle
          shuffle = !shuffle;
          modeShuffle.textContent = `ğŸ”€ Shuffle: ${shuffle ? 'on' : 'off'}`;
          persistState();
          break;
        case 'KeyR': // toggle repeat
          repeat = (repeat + 1) % 3;
          modeRepeat.textContent = `ğŸ” Repeat: ${repeat === 0 ? 'off' : (repeat === 1 ? 'one' : 'all')}`;
          persistState();
          break;
      }
    });
  </script></body>
</html>
