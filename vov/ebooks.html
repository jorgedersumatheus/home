
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>E-books — JOR NEWS V O V</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <style>
    :root{
      --bg:#0a0a0a; --panel:#111; --ink:#e6eef2; --blue:#00aaff; --blue2:#00ccff; --muted:#9aa3a7;
      --ring:0 0 0 2px rgba(0,170,255,.25);
      --border:#1f2a36;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    a{color:var(--blue2)}
    header{background:linear-gradient(90deg,#000,#001f3f);padding:22px 16px;text-align:center;border-bottom:1px solid #0f2238}
    header h1{margin:0;font-size:1.9rem;letter-spacing:0.5px}
    header p{margin:6px 0 0;color:var(--muted)}
    nav{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:12px}
    nav a{color:#fff;text-decoration:none;border:1px solid #1b3b5e;padding:8px 12px;border-radius:10px}
    nav a:hover{background:#1b3b5e}
    main{max-width:1200px;margin:32px auto;padding:0 16px}
    .bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;gap:12px;flex-wrap:wrap}
    .bar h2{margin:0;color:var(--blue);border-bottom:2px solid var(--blue);padding-bottom:6px}
    .search{display:flex;gap:8px;align-items:center}
    .search input{background:#0f0f0f;border:1px solid #222;color:var(--ink);padding:10px 12px;border-radius:10px;min-width:260px;outline:none}
    .search input:focus{box-shadow:var(--ring);border-color:#0e5f84}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
    .cover{aspect-ratio:4/5;background:#0e0e0e;display:flex;align-items:center;justify-content:center}
    .cover img{width:100%;height:100%;object-fit:cover;display:block}
    .content{padding:14px 14px 8px}
    .title{font-weight:700;margin:0 0 6px;font-size:1.02rem}
    .meta{color:var(--muted);font-size:.9rem;margin:0 0 10px}
    .desc{color:#cbd5da;font-size:.95rem;margin:0 0 12px;line-height:1.35}
    .btns{display:flex;gap:8px;flex-wrap:wrap;padding:0 14px 14px}
    .btn{flex:1 0 auto;text-align:center;text-decoration:none;color:#000;background:var(--blue2);padding:9px 10px;border-radius:10px;font-weight:700}
    .btn.outline{background:transparent;color:var(--blue2);border:1px solid var(--blue2)}
    .empty{opacity:.8;border:1px dashed #2a2a2a;border-radius:14px;padding:20px;text-align:center}
    footer{text-align:center;padding:20px;background:#001f3f;color:#aab; margin-top:28px;font-size:.9rem;border-top:1px solid #0f2238}
    .tag{display:inline-block;background:#082333;color:#8fd9ff;border:1px solid #134861;border-radius:999px;padding:4px 8px;font-size:.8rem;margin-left:6px}
    .note{background:#0f0f0f;border:1px solid #2a2a2a;color:#cbd5da;padding:12px;border-radius:12px;margin:16px 0}
    .warn{border-color:#4c2b2b;background:#120c0c;color:#ffb3b3}
    .ok{border-color:#1f3f2b;background:#0c120e;color:#b7ffcf}
    .tiny{font-size:.85rem;color:#a5b2bb}
    .selo{font-weight:700;letter-spacing:.5px}
  </style>
</head>
<body>
  <header>
    <h1>Biblioteca V O V — E-books</h1>
    <p>Pílulas de leitura com capa, mini-resumo e acesso direto ao PDF. <span class="selo">V • O • V</span></p>
    <nav>
      <a href="/vov/index.html">Início</a>
      <a href="/vov/edicoes.html">Arquivo de Edições</a>
      <a href="/vov/ebooks.html"><b>E-books</b></a>
      <a href="/vov/blackvox/tocador_vov.html">BLACKVOX</a>
      <a href="/vov/contato.html">Contato</a>
    </nav>
  </header>

  <main>
    <div class="bar">
      <h2>Coleção completa <span class="tag" id="count">—</span></h2>
      <div class="search">
        <input id="q" type="search" placeholder="Buscar por título ou autor…" />
      </div>
    </div>

    <!-- Avisos -->
    <div id="status" class="note tiny">Carregando a coleção do Google Drive…</div>

    <div id="grid" class="grid" aria-live="polite"></div>
    <div id="empty" class="empty" style="display:none">
      Nenhum e-book encontrado para sua busca. Tente outro termo.
    </div>

    <!-- Fallback: cole JSON aqui se o fetch ao Drive não puder ser usado -->
    <script id="fallback-data" type="application/json">
      []
    </script>

    <section class="note ok tiny" id="howto" style="display:none">
      <b>Dica:</b> se o carregamento automático do Drive falhar (permissões/CORS), publique o arquivo do Drive como JSON acessível ao público
      ou cole os dados JSON diretamente no bloco <code>#fallback-data</code> acima e recarregue a página.
    </section>
  </main>

  <footer>
    © 2025 V O V — Ver • Ouvir • Vender • Viver · <a href="/vov/index.html">Portal</a> · <a href="/vov/edicoes.html">Edições</a> · <a href="/vov/blackvox/tocador_vov.html">BLACKVOX</a> · <a href="/vov/contato.html">Contato</a>
  </footer>

  <script>
    // ========= CONFIG =========
    const FILE_ID = "1YimoiOzBgxRn13hclZReQkkq10jsSznD"; // seu arquivo no Drive
    const DRIVE_URL = `https://drive.google.com/uc?id=${FILE_ID}&export=download`;

    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const count = document.getElementById('count');
    const q = document.getElementById('q');
    const status = document.getElementById('status');
    const howto = document.getElementById('howto');

    let ebooks = [];

    function card(e){
      const capa = e.capa || 'https://via.placeholder.com/600x750?text=Capa';
      const pdf  = e.pdf  || '#';
      const titulo = e.titulo || 'Sem título';
      const autor = e.autor || '—';
      const ano   = e.ano   || '';
      const desc  = e.descricao || '';

      const art = document.createElement('article');
      art.className = 'card';
      art.dataset.title = titulo.toLowerCase();
      art.dataset.author = autor.toLowerCase();

      art.innerHTML = `
        <div class="cover">
          <img src="${capa}" alt="Capa — ${titulo}" onerror="this.src='https://via.placeholder.com/600x750?text=Capa+indispon%C3%ADvel'">
        </div>
        <div class="content">
          <h3 class="title">${titulo}</h3>
          <p class="meta">Autor: ${autor}${ano ? ' • ' + ano : ''}</p>
          <p class="desc">${desc}</p>
        </div>
        <div class="btns">
          <a class="btn" href="${pdf}" target="_blank" rel="noopener">Ler PDF</a>
          ${capa ? `<a class="btn outline" href="${capa}" target="_blank" rel="noopener">Ver capa</a>` : ''}
        </div>`;
      return art;
    }

    function render(list){
      grid.innerHTML = '';
      list.forEach(e => grid.appendChild(card(e)));
      updateCount(list.length);
      empty.style.display = list.length ? 'none' : 'block';
    }

    function updateCount(n){
      count.textContent = n === 1 ? '1 título' : `${n} títulos`;
    }

    function filter(){
      const term = (q.value || '').toLowerCase().trim();
      const filtered = ebooks.filter(e => {
        const hay = (e.titulo || '') + ' ' + (e.autor || '');
        return hay.toLowerCase().includes(term);
      });
      render(filtered);
    }

    q.addEventListener('input', filter);

    async function loadFromDrive(){
      try{
        const res = await fetch(DRIVE_URL, { mode: 'cors' });
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const text = await res.text();

        // Tentar JSON direto
        let data;
        try{
          data = JSON.parse(text);
        }catch(_){
          // Pode ser arquivo com "code fence" ou algum blob — tentar limpar
          const cleaned = text.replace(/^[\s\S]*?\[/, '[').replace(/\][\s\S]*$/, ']');
          data = JSON.parse(cleaned);
        }

        if(!Array.isArray(data)) throw new Error('Formato inesperado (esperado: array JSON)');
        ebooks = data;
        status.className = 'note ok tiny';
        status.textContent = 'Coleção carregada do Google Drive.';
        render(ebooks);
      }catch(err){
        console.warn('Falha no carregamento do Drive:', err);
        status.className = 'note warn tiny';
        status.innerHTML = 'Não foi possível carregar automaticamente do Google Drive. Você pode <b>publicar o arquivo como JSON público</b> no Drive ou <b>colar os dados JSON</b> no bloco interno desta página.';
        howto.style.display = 'block';

        // fallback local
        try{
          const fallback = document.getElementById('fallback-data').textContent.trim();
          const data = JSON.parse(fallback || '[]');
          ebooks = data;
          if(ebooks.length){
            render(ebooks);
            status.className = 'note ok tiny';
            status.innerHTML += '<br>Usando dados locais (fallback).';
          }else{
            render([]);
          }
        }catch(e2){
          render([]);
        }
      }
    }

    loadFromDrive();
  </script>
</body>
</html>
